<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Three.js Dice Roll - Choose Number</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #111;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      #canvas-container {
        flex: 1;
      }

      #ui {
        padding: 10px;
        background: #222;
        border-top: 1px solid #333;
        text-align: center;
      }

      select,
      button {
        padding: 8px 14px;
        font-size: 16px;
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <div id="canvas-container"></div>

    <div id="ui">
      <select id="chosenNumber">
        <option value="1">Land on 1</option>
        <option value="2">Land on 2</option>
        <option value="3">Land on 3</option>
        <option value="4">Land on 4</option>
        <option value="5">Land on 5</option>
        <option value="6" selected>Land on 6</option>
      </select>

      <button id="rollButton">Roll</button>
    </div>

    <script type="module">
      import * as THREE from "https://unpkg.com/three@latest/build/three.module.js";

      const container = document.getElementById("canvas-container");

      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x111111);

      const camera = new THREE.PerspectiveCamera(
        45,
        window.innerWidth / (window.innerHeight - 50),
        0.1,
        100
      );
      camera.position.set(3, 3, 4);
      camera.lookAt(0, 0, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight - 50);
      container.appendChild(renderer.domElement);

      const ambient = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambient);

      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(5, 10, 7);
      scene.add(dir);

      const textureLoader = new THREE.TextureLoader();

      /*
        BoxGeometry materials order:
        0: +X (right)
        1: -X (left)
        2: +Y (top)
        3: -Y (bottom)
        4: +Z (front)
        5: -Z (back)
      */

      const materials = [
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice4.png") }), // +X
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice3.png") }), // -X
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice6.png") }), // +Y (TOP)
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice1.png") }), // -Y (BOTTOM)
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice2.png") }), // +Z
        new THREE.MeshStandardMaterial({ map: textureLoader.load("dice5.png") }), // -Z
      ];

      const geo = new THREE.BoxGeometry(1, 1, 1);
      const dice = new THREE.Mesh(geo, materials);
      dice.position.y = 0.5;
      scene.add(dice);

      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(10, 10),
        new THREE.MeshStandardMaterial({ color: 0x222222 })
      );
      ground.rotation.x = -Math.PI / 2;
      scene.add(ground);

      let rolling = false;
      let rollFrame = 0;
      const maxRollFrames = 60;

      // Current faces (with rotation = 0,0,0):
      //  6 on top (+Y)
      //  1 bottom (-Y)
      //  4 right (+X)
      //  3 left (-X)
      //  2 front (+Z)
      //  5 back (-Z)

      // Rotations to bring each number to the TOP (+Y)
      const numberToRotation = {
        1: { x: Math.PI, y: 0, z: 0 },             // bottom (-Y) -> top
        2: { x: -Math.PI / 2, y: 0, z: 0 },        // front (+Z) -> top
        3: { x: 0, y: 0, z: -Math.PI / 2 },        // left (-X) -> top
        4: { x: 0, y: 0, z: Math.PI / 2 },         // right (+X) -> top
        5: { x: Math.PI / 2, y: 0, z: 0 },         // back (-Z) -> top
        6: { x: 0, y: 0, z: 0 },                   // already on top
      };

      let targetRotation = { x: 0, y: 0, z: 0 };

      function rollDice() {
        if (rolling) return;

        const selected = parseInt(
          document.getElementById("chosenNumber").value,
          10
        );

        targetRotation = numberToRotation[selected];

        // Start rolling
        rolling = true;
        rollFrame = 0;
      }

      function animate() {
        requestAnimationFrame(animate);

        if (rolling) {
          rollFrame++;

          // Random spin while rolling
          dice.rotation.x += 0.3;
          dice.rotation.y += 0.4;
          dice.rotation.z += 0.2;

          if (rollFrame >= maxRollFrames) {
            rolling = false;

            // Snap to chosen orientation where the selected number is on top
            dice.rotation.set(
              targetRotation.x,
              targetRotation.y,
              targetRotation.z
            );
          }
        }

        renderer.render(scene, camera);
      }

      animate();

      document.getElementById("rollButton").addEventListener("click", rollDice);

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / (window.innerHeight - 50);
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight - 50);
      });
    </script>
  </body>
</html>
